<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <link rel="stylesheet" href="css/style.css">
    <title>ChatCord - Escolha sua Sala</title>
</head>
<body>
    <div class="join-container">
        <header class="join-header">
            <h1><i class="fas fa-comments"></i> ChatCord</h1>
            <p>Escolha uma sala e comece a conversar</p>
        </header>
        
        <main class="join-main">
            <div class="user-info" id="userInfo">
                <p>
                    <i class="fas fa-user-circle"></i> 
                    Conectado como: <span id="currentUser"></span>
                </p>
                <button class="btn btn-danger" onclick="logout()">
                    <i class="fas fa-sign-out-alt"></i> Sair
                </button>
            </div>
            
            <form action="chat.html" method="get" id="roomForm">
                <div class="form-control">
                    <label for="room">
                        <i class="fas fa-door-open"></i> Selecione uma Sala
                    </label>
                    <select name="room" id="room" required>
                        <option value="">Escolha uma sala...</option>
                        <option value="Geral">ğŸ’¬ Geral</option>
                        <option value="JavaScript">ğŸŸ¨ JavaScript</option>
                        <option value="Python">ğŸ Python</option>
                        <option value="PHP">ğŸ˜ PHP</option>
                        <option value="C#">ğŸ”· C#</option>
                        <option value="Ruby">ğŸ’ Ruby</option>
                        <option value="Java">â˜• Java</option>
                        <option value="React">âš›ï¸ React</option>
                        <option value="Vue">ğŸ’š Vue.js</option>
                        <option value="Angular">ğŸ…°ï¸ Angular</option>
                    </select>
                </div>
                
                <button type="submit" class="btn btn-primary">
                    <i class="fas fa-rocket"></i> Entrar na Sala
                </button>
            </form>
            
            <div class="commands-help">
                <h3><i class="fas fa-terminal"></i> Comandos DisponÃ­veis</h3>
                <ul>
                    <li><code>/help</code> - Mostra lista de comandos</li>
                    <li><code>/users</code> - Lista usuÃ¡rios online na sala</li>
                    <li><code>/rooms</code> - Lista todas as salas disponÃ­veis</li>
                    <li><code>/time</code> - Mostra a hora atual</li>
                    <li><code>/exit</code> ou <code>/quit</code> - Sair da sala</li>
                    <li><code>/clear</code> - Limpar histÃ³rico de mensagens</li>
                    <li><code>/shutdown</code> - Desligar servidor (apenas admin)</li>
                </ul>
            </div>
        </main>
    </div>

    <script>
        // Verificar autenticaÃ§Ã£o
        let user = null;
        try {
            user = JSON.parse(localStorage.getItem('chatUser'));
        } catch (e) {
            console.error('Erro ao ler dados do usuÃ¡rio:', e);
        }

        if (!user || !user.username) {
            console.log('UsuÃ¡rio nÃ£o encontrado, redirecionando para login');
            window.location.href = 'login.html';
        } else {
            console.log('UsuÃ¡rio logado:', user);
            const userSpan = document.getElementById('currentUser');
            userSpan.textContent = user.username;
            
            if (user.role === 'admin') {
                userSpan.innerHTML += ' <i class="fas fa-crown" style="color: #f6ad55; margin-left: 4px;"></i>';
            }
        }

        function logout() {
            localStorage.removeItem('chatUser');
            window.location.href = 'login.html';
        }

        // Validar formulÃ¡rio antes de enviar
        document.getElementById('roomForm').addEventListener('submit', function(e) {
            const user = JSON.parse(localStorage.getItem('chatUser'));
            if (!user) {
                e.preventDefault();
                alert('SessÃ£o expirada. FaÃ§a login novamente.');
                window.location.href = 'login.html';
                return;
            }
            
            const room = document.getElementById('room').value;
            if (!room) {
                e.preventDefault();
                alert('Por favor, selecione uma sala.');
                return;
            }
        });

        // AnimaÃ§Ã£o para o select
        document.getElementById('room').addEventListener('change', function() {
            this.style.transform = 'scale(1.02)';
            setTimeout(() => {
                this.style.transform = 'scale(1)';
            }, 150);
        });
    </script>
</body>
</html>